name: CI

# Control when the action will run.
# Triggers the workflow on push or pull request events for the main branch.
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This job builds, tests, and analyzes the code.
  build_and_test:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        python-version: ['3.10', '3.11', '3.12', '3.13']

    steps:
      # Checks-out your repository into the way the GitHub Actions runner can access it.
      - name: Checkout Repository
        uses: actions/checkout@v4

      # Set up Python environment
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}
          cache: 'uv'

      # Install dependencies using uv
      - name: Install Dependencies with uv
        run: |
          uv --version
          uv pip install --system --upgrade pip
          uv pip install --system "ruff"
          uv pip install --system "pytest"
          uv pip install --system ".[dev]"
        # Note: If your project has a specific install command for development dependencies (e.g., `pip install -e .[dev]`), adjust accordingly.
        # The example assumes `pyproject.toml` defines an optional dependency group `[project.optional-dependencies.dev]`.

      # Run Ruff for linting and formatting
      - name: Lint with Ruff
        run: ruff check . --output-format github
        # If you want to also format, uncomment the next line and ensure ruff is configured for it.
        # run: ruff check --fix . --output-format github

      # Run Pytest for testing
      - name: Test with Pytest
        run: pytest
        # If you need coverage, you would typically install a coverage tool and configure pytest-cov:
        # env:
        #   PYTHON_COLORS: "true"
        # run: pytest --cov=aqua_scout --cov-report=xml
        # Then, upload coverage to a service like Codecov:
        # - name: Upload coverage to Codecov
        #   uses: codecov/codecov-action@v4
        #   with:
        #     token: ${{ secrets.CODECOV_TOKEN }}
        #     file: ./coverage.xml

      # Optional: Build the CLI if applicable (e.g., using Poetry build or similar)
      # - name: Build Distribution
      #   run: poetry build
